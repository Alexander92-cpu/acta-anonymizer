[tox]
envlist = py38,py39,py310,py311,py312,py313,lint,type,build
isolated_build = True
skip_missing_interpreters = True

[testenv]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
commands = 
    pytest {posargs}

[testenv:lint]
deps = 
    black>=22.0.0
    flake8>=5.0.0
    isort>=5.10.0
commands = 
    black --check --diff src tests
    isort --check-only --diff src tests
    flake8 src tests

[testenv:format]
deps = 
    black>=22.0.0
    isort>=5.10.0
commands = 
    black src tests
    isort src tests

[testenv:type]
deps = 
    mypy>=1.0.0
    types-requests
commands = 
    mypy src

[testenv:build]
deps = 
    build
    twine
commands = 
    python -m build
    twine check dist/*

[testenv:install]
deps = 
commands = 
    pip install -e .
    acta-anonymizer --help

[testenv:deps-check]
deps = 
    pip-tools
    safety
commands = 
    pip-compile --dry-run pyproject.toml
    safety check

[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = 
    .git,
    __pycache__,
    .tox,
    .eggs,
    *.egg,
    build,
    dist,
    .venv

[coverage:run]
source = src
omit = 
    */tests/*
    */__pycache__/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
